{'role': 'assistant', 'content': '\n<function_calls>\n<create-file file_path="src/components/ui/Modal.tsx">\nimport React, { useEffect, useRef } from \'react\';\nimport { createPortal } from \'react-dom\';\nimport { cn } from \'@/lib/utils\';\nimport { Button } from \'./Button\';\nimport { X } from \'lucide-react\';\n\nexport interface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  children: React.ReactNode;\n  size?: \'sm\' | \'md\' | \'lg\' | \'xl\' | \'full\';\n  showCloseButton?: boolean;\n  closeOnOverlayClick?: boolean;\n  closeOnEscape?: boolean;\n  footer?: React.ReactNode;\n  className?: string;\n}\n\nconst Modal: React.FC<ModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  size = \'md\',\n  showCloseButton = true,\n  closeOnOverlayClick = true,\n  closeOnEscape = true,\n  footer,\n  className,\n}) => {\n  const modalRef = useRef<HTMLDivElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === \'Escape\' && closeOnEscape) {\n        onClose();\n      }\n    };\n\n    const handleFocusTrap = (event: KeyboardEvent) => {\n      if (event.key === \'Tab\') {\n        const focusableElements = modalRef.current?.querySelectorAll(\n          \'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])\'\n        ) as NodeListOf<HTMLElement>;\n\n        if (focusableElements.length === 0) return;\n\n        const firstElement = focusableElements[0];\n        const lastElement = focusableElements[focusableElements.length - 1];\n\n        if (event.shiftKey) {\n          if (document.activeElement === firstElement) {\n            event.preventDefault();\n            lastElement.focus();\n          }\n        } else {\n          if (document.activeElement === lastElement) {\n            event.preventDefault();\n            firstElement.focus();\n          }\n        }\n      }\n    };\n\n    document.addEventListener(\'keydown\', handleEscape);\n    document.addEventListener(\'keydown\', handleFocusTrap);\n    \n    // Prevent body scroll\n    document.body.style.overflow = \'hidden\';\n    \n    // Focus first element\n    const firstFocusableElement = modalRef.current?.querySelector(\n      \'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])\'\n    ) as HTMLElement;\n    firstFocusableElement?.focus();\n\n    return () => {\n      document.removeEventListener(\'keydown\', handleEscape);\n      document.removeEventListener(\'keydown\', handleFocusTrap);\n      document.body.style.overflow = \'\';\n    };\n  }, [isOpen, onClose, closeOnEscape]);\n\n  if (!isOpen) return null;\n\n  const sizeClasses = {\n    sm: \'max-w-md\',\n    md: \'max-w-lg\',\n    lg: \'max-w-2xl\',\n    xl: \'max-w-4xl\',\n    full: \'max-w-full mx-4\',\n  };\n\n  const handleOverlayClick = (event: React.MouseEvent) => {\n    if (event.target === overlayRef.current && closeOnOverlayClick) {\n      onClose();\n    }\n  };\n\n  const modalContent = (\n    <div className="fixed inset-0 z-50 flex items-center justify-center">\n      {/* Overlay */}\n      <div\n        ref={overlayRef}\n        className="fixed inset-0 bg-black/50 backdrop-blur-sm"\n        onClick={handleOverlayClick}\n        aria-hidden="true"\n      />\n\n      {/* Modal */}\n      <div\n        ref={modalRef}\n        className={cn(\n          \'relative z-10 w-full rounded-lg bg-white dark:bg-gray-800 shadow-xl\',\n          \'max-h-[90vh] overflow-hidden flex flex-col\',\n          sizeClasses[size],\n          className\n        )}\n        role="dialog"\n        aria-modal="true"\n        aria-labelledby={title ? \'modal-title\' : undefined}\n      >\n        {/* Header */}\n        {(title || showCloseButton) && (\n          <div className="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">\n            {title && (\n              <h2 id="modal-title" className="text-lg font-semibold text-gray-900 dark:text-gray-100">\n                {title}\n              </h2>\n            )}\n            {showCloseButton && (\n              <Button\n                variant="ghost"\n                size="icon"\n                onClick={onClose}\n                className="h-8 w-8 p-0"\n                aria-label="Close modal"\n              >\n                <X className="h-4 w-4" />\n              </Button>\n            )}\n          </div>\n        )}\n\n        {/* Content */}\n        <div className="flex-1 overflow-y-auto p-6">\n          {children}\n        </div>\n\n        {/* Footer */}\n        {footer && (\n          <div className="p-6 border-t border-gray-200 dark:border-gray-700">\n            {footer}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  return createPortal(modalContent, document.body);\n};\n\n// Modal-specific components\nexport const ModalHeader: React.FC<{ children: React.ReactNode; className?: string }> = ({\n  children,\n  className,\n}) => (\n  <div className={cn(\'p-6 border-b border-gray-200 dark:border-gray-700\', className)}>\n    {children}\n  </div>\n);\n\nexport const ModalBody: React.FC<{ children: React.ReactNode; className?: string }> = ({\n  children,\n  className,\n}) => (\n  <div className={cn(\'p-6 flex-1 overflow-y-auto\', className)}>\n    {children}\n  </div>\n);\n\nexport const ModalFooter: React.FC<{ children: React.ReactNode; className?: string }> = ({\n  children,\n  className,\n}) => (\n  <div className={cn(\'p-6 border-t border-gray-200 dark:border-gray-700\', className)}>\n    {children}\n  </div>\n);\n\n// Confirmation Modal\nexport interface ConfirmModalProps extends Omit<ModalProps, \'children\' | \'footer\'> {\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  variant?: \'default\' | \'destructive\';\n  onConfirm: () => void;\n}\n\nexport const ConfirmModal: React.FC<ConfirmModalProps> = ({\n  message,\n  confirmText = \'Confirm\',\n  cancelText = \'Cancel\',\n  variant = \'default\',\n  onConfirm,\n  ...modalProps\n}) => {\n  const handleConfirm = () => {\n    onConfirm();\n    modalProps.onClose();\n  };\n\n  return (\n    <Modal\n      {...modalProps}\n      footer={\n        <div className="flex justify-end gap-3">\n          <Button variant="outline" onClick={modalProps.onClose}>\n            {cancelText}\n          </Button>\n          <Button\n            variant={variant === \'destructive\' ? \'destructive\' : \'default\'}\n            onClick={handleConfirm}\n          >\n            {confirmText}\n          </Button>\n        </div>\n      }\n    >\n      <p className="text-gray-700 dark:text-gray-300">{message}</p>\n    </Modal>\n  );\n};\n\nexport { Modal };\n</create-file>\n</function_calls>'}