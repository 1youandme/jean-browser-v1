use serde::{Deserialize, Serialize};
use std::collections::HashMap;
use uuid::Uuid;
use chrono::{DateTime, Utc};
use tokio::sync::RwLock;
use std::sync::Arc;

use crate::models::{JeanMemory, JeanAction, JeanPermission, User};
use crate::commands::{CommandResult, DatabasePool};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct JeanRequest {
    pub user_id: Uuid,
    pub session_id: Option<String>,
    pub message: String,
    pub context: Option<serde_json::Value>,
    pub attachments: Option<Vec<JeanAttachment>>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct JeanAttachment {
    pub r#type: String, // image, file, url
    pub content: String,
    pub metadata: Option<serde_json::Value>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct JeanResponse {
    pub message: String,
    pub actions: Vec<JeanAction>,
    pub requires_confirmation: bool,
    pub context_updates: Option<serde_json::Value>,
    pub memory_entries: Option<Vec<JeanMemory>>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct JeanAction {
    pub id: Uuid,
    pub action_type: String,
    pub description: String,
    pub data: serde_json::Value,
    pub requires_confirmation: bool,
    pub estimated_impact: String,
    pub category: ActionCategory,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum ActionCategory {
    Browser,
    FileSystem,
