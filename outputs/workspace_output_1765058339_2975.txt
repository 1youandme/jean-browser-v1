-- E-commerce Dropshipping Database Schema
-- Migration 004: E-commerce System Tables

-- Products Table
CREATE TABLE products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(500) NOT NULL,
    description TEXT,
    category VARCHAR(100) NOT NULL,
    subcategory VARCHAR(100),
    brand VARCHAR(200),
    sku VARCHAR(100) UNIQUE,
    upc VARCHAR(50),
    images JSONB, -- Array of image URLs with metadata
    specifications JSONB, -- Product specifications
    variants JSONB, -- Size, color, etc. options
    tags TEXT[],
    
    -- Source Information
    source_url VARCHAR(1000) NOT NULL,
    source_platform VARCHAR(50) NOT NULL CHECK (source_platform IN ('alibaba', '1688', 'amazon', 'aliexpress')),
    source_product_id VARCHAR(200),
    upload_date TIMESTAMP WITH TIME ZONE,
    
    -- Pricing Information
    cost_price DECIMAL(10,2) NOT NULL, -- Supplier price
    selling_price DECIMAL(10,2),
    margin_percentage DECIMAL(5,2),
    shipping_cost DECIMAL(10,2),
    total_cost DECIMAL(10,2),
    currency VARCHAR(3) DEFAULT 'USD',
    
    -- Competitor Pricing
    amazon_price DECIMAL(10,2),
    aliexpress_price DECIMAL(10,2),
    competitor_margin DECIMAL(5,2),
    price_last_updated TIMESTAMP WITH TIME ZONE,
    
    -- Status and Flags
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'analyzing', 'priced', 'active', 'inactive', 'discontinued')),
    is_new BOOLEAN DEFAULT FALSE,
    is_featured BOOLEAN DEFAULT FALSE,
    is_promo_active BOOLEAN DEFAULT FALSE,
    is_visible BOOLEAN DEFAULT TRUE,
    
    -- Inventory (for reference, not used in dropshipping)
    stock_status VARCHAR(20) DEFAULT 'available',
    min_order_quantity INTEGER DEFAULT 1,
    
    -- SEO
